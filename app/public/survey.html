<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Friend Finder</title>
    <!-- Latest compiled and minified CSS & JS -->
  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  	<script src="https://code.jquery.com/jquery.js"></script>
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

  	<!-- Font Awesome -->
  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

  	<!-- Chosen -->
  	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.css">
  	<script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.jquery.min.js"></script>

  </head>
  <body>
    <div class="container">
      <div class="jumbotron">
        <h1>
          Survey Questions
        </h1>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          <h2>About You</h2>
          </div>
        <div class="panel-body">
          <label for="userName">Enter Your Name (Required)</label>
          <div class="input-group">
            <input type="text" class="form-control" id="userName" aria-describedby="basic-addon3">
          </div>
          <hr>
          <label for="picURL">Post a Link to Your Picture</label>
          <div class="input-group">
            <input type="text" class="form-control" id="picURL" aria-describedby="basic-addon3">
          </div>
        </div> 
      </div> 

        <h3><strong>Question 1</strong></h3>
          <h4>Do you like Pizza?</h4>
          <select data-placeholder="" class="chosen-select" id="q1" style="display: none;">
            <option value=""></option>
            <option value="1">1 (Strong Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
          </select>

        <h3><strong>Question 2</strong></h3>
          <h4>Your ideal weather.</h4>
          <select data-placeholder="" class="chosen-select" id="q2" style="display:none;">
            <option value=""></option>
            <option value="1">1 (Colder)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Hotter)</option>
          </select>

        <h3><strong>Question 3</strong></h3>
          <h4>What animal represents you?</h4>
          <select data-placeholder="" class="chosen-select" id="q3" style="display:none;">
            <option value=""></option>
            <option value="1">1 (Strong Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
          </select>

        <h3><strong>Question 4</strong></h3>
          <h4>I stick to the rivers and lakes that I'm used to</h4>
          <select data-placeholder="" class="chosen-select" id="q4" style="display:none;">
            <option value=""></option>
            <option value="1">1 (Wolf)</option>
            <option value="2">2 (Lion)</option>
            <option value="3">3 (Bunny)</option>
            <option value="4">4 (Horse)</option>
            <option value="5">5 (Squid)</option>
          </select>

        <h3><strong>Question 5</strong></h3>
          <h4>Do you like to read?</h4>
          <select data-placeholder="" class="chosen-select" id="q5" style="display:none;">
            <option value=""></option>
            <option value="1">1 (Strong Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
          </select>

        <h3><strong>Question 6</strong></h3>
          <h4>Are you a petrolhead?</h4>
          <select data-placeholder="" class="chosen-select" id="q6" style="display:none;">
            <option value=""></option>
            <option value="1">1 (...a What?)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
          </select>

        <h3><strong>Question 7</strong></h3>
          <h4>Are you outgoing?</h4>
          <select data-placeholder="" class="chosen-select" id="q7" style="display:none;">
            <option value=""></option>
            <option value="1">1 (Strong Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
          </select>

        <h3><strong>Question 8</strong></h3>
          <h4>Like to get outdoors?</h4>
          <select data-placeholder="" class="chosen-select" id="q8" style="display:none;">
            <option value=""></option>
            <option value="1">1 (Strong Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
          </select>

        <h3><strong>Question 9</strong></h3>
          <h4>Do you like travelling?</h4>
          <select data-placeholder="" class="chosen-select" id="q9" style="display:none;">
            <option value=""></option>
            <option value="1">1 (Strong Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
          </select>

        <h3><strong>Question 10</strong></h3>
        <h4>Do you like questionaires?</h4>
        <select data-placeholder="" class="chosen-select" id="q10" style="display:none;">
          <option value=""></option>
          <option value="1">1 (Strong Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>

            <hr>
            <button type="submit" class="btn btn-primary btn-lg btn-block" id="submit">Submit
            </button>
            <hr>
      <div class="footer">
        <p>
          <a href="/">
            Back to Home
          </a>
          |
          <a target="_blank" href="/api/friends">
            API Friends List
          </a>
          |
          <a target="_blank" href="https://github.com/RaidoFive/FriendFinder">Github Repo</a>
        </p>
      </div> 
    </div> 

    <!-- Modal -->
  	<div id="resultsModal" class="modal fade" role="dialog">
  	  <div class="modal-dialog">

  	    <!-- Modal content-->
  	    <div class="modal-content">
  	      <div class="modal-header">
  	        <button type="button" class="close" data-dismiss="modal">&times;</button>
  	        <h2 class="modal-title"><strong>Best Match</strong></h2>
  	      </div>
  	      <div class="modal-body">
  	        <h2 id="matchName"></h2>
  	        <img id="matchImg" src="" alt="">
  	      </div>
  	      <div class="modal-footer">
  	        <button type="button" class="btn btn-" data-dismiss="modal">Close</button>
            <a href="/">
              <button type="button" class="btn btn-primary">Back to Home</button>
            </a>
          </div>
        </div> <!-- end modal content -->
  	  </div>
  	</div> <!-- end results modal -->

    <script type="text/javascript">

    // Chosen CSS
    $(".chosen-select").chosen({width: "35%"});

        var config = {
          '.chosen-select'           : {},
          '.chosen-select-deselect'  : {allow_single_deselect:true},
          '.chosen-select-no-single' : {disable_search_threshold:10},
          '.chosen-select-no-results': {no_results_text:'Oops, nothing found!'},
          '.chosen-select-width'     : {width:"95%"},
        }
        for (var selector in config) {
          $(selector).chosen(config[selector]);
        }

        // Capture the form inputs
        $("#submit").on("click", function(){

          	// Form validation
          	function validateForm() {
      		  var isValid = true;
      		  $('.form-control').each(function() {
      		    if ( $(this).val() === '' )
      		        isValid = false;
      		  });

      		  $('.chosen-select').each(function() {

      		  	if( $(this).val() === "")
      		  		isValid = false
      		  })
      		  return isValid;
      		}

    		// If all required fields are filled
    		if (validateForm() == true)
    		{

          // to avoid illegal invocation, assign variables to each input field, use those
          // variables to create an object for total user data
          var name = $("#userName").val();
          var pic =  $("#picURL").val();
          var q1 = $("#q1").val();
          var q2 = $("#q2").val();
          var q3 = $("#q3").val();
          var q4 = $("#q4").val();
          var q5 = $("#q5").val();
          var q6 = $("#q6").val();
          var q7 = $("#q7").val();
          var q8 = $("#q8").val();
          var q9 = $("#q9").val();
          var q10 = $("#q10").val();

          var userData = {
  	    		name: name,
  	    		photo: pic,
  	    		scores: [q1, q2, q3, q4, q5, q6, q7, q8, q9, q10]
  	    	}

    	    	// Grab the URL of the website
    	    	var currentURL = window.location.origin;

    	    	// AJAX call to post the data to the friends API.
    	    	$.post(currentURL + "/api/friends", userData, function(data){

    	    		// Grab the result from the AJAX post so that the best match's name and photo are displayed.
              $.get("/api/selectedFriend", function(data) {
                console.log(data);
              $("#matchName").text(data.name);
              $('#matchImg').attr("src", data.photo);

              // Show the modal with the best match
              $("#resultsModal").modal('toggle');

              })
              
    	    	});

    		}
    		else
    		{
    			alert("Please fill out all fields before submitting!");
    		}

          var currentURL = window.location.origin;
          $.get(currentURL + "/", function(data){

          })
        	return false;
        });

      </script>

  </body>
</html>
